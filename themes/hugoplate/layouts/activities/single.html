{{ define "main" }}
  {{ with .Params.activity }}
    <section class="relative overflow-hidden pt-14 h-screen flex items-center justify-center pointer-events-none">
      <!-- Background Video -->
      <video
        autoplay
        muted
        loop
        playsinline
        class="absolute top-0 left-0 w-full h-full object-cover -z-10">
        <source src="{{ "videos/norma-loops-bg.mp4" | relURL }}" type="video/mp4" />
        Your browser does not support the video tag.
      </video>

      <!-- Dark overlay with gradient -->
      <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-black/40 via-black/50 to-black/60 -z-10 "></div>

      <!-- Foreground Content -->
      <div class="container relative -z-5 animate-fade-in">
        <div class="row justify-center">
          <div class="lg:col-7 md:col-9 mb-8 text-center">
            <div class=" text-black  p-8.5 transition-all duration-500 ">
              <div class="col-12 mb-6 animate-slide-up">
                {{ $logoStr := .logo }}
                {{ $logo := printf "%s" (substr $logoStr 1) }}
                {{ partial "image" (dict "Src" $logo "Alt" "Logo" "Loading" "eager" "Class" "mx-auto lg:w-[300px] transition-transform duration-300" "DisplayXL" "500x") }}
              </div>

              {{ with .button }}
                {{ if .enable }}
                  <div class="animate-slide-up-delayed">
                    <a
                      class="btn btn-primary transform transition-all duration-300 active:scale-95"
                      href="{{ .link | absURL }}"
                      {{ if strings.HasPrefix .link "http" }}
                        target="_blank" rel="noopener"
                      {{ end }}>
                      {{ .label }} <i class="fa fa-arrow-right pl-2 transition-transform duration-200 "></i>
                    </a>
                  </div>
                {{ end }}
              {{ end }}
            </div>
          </div>
        </div>
      </div>


    </section>

    <div class="container mt-8 my-24 pt-8 text-text bg-white rounded-3xl pb-12 shadow-lg animate-fade-in-up transition-all duration-500 hover:shadow-xl">
      <h2 class="text-xl font-semibold mb-4 text-center animate-slide-in-left">
        {{ i18n "activity_single.description_text" }}
      </h2>
      <div class="prose max-w-none animate-fade-in-delayed">
        {{ .description | markdownify }}
      </div>

      <div class="flex flex-col md:flex-row gap-8 justify-center mt-8">
        <!-- Schedule -->
        <div class="bg-body p-6 rounded-4xl shadow-4xl basis-[51%] max-w-full card-hover animate-slide-in-left">
          <h2 class="text-xl font-semibold mb-4 text-center">
            {{ i18n "activity_single.schedule_text" }}
          </h2>

          <div class="flex flex-wrap justify-center gap-2 mb-4">
            {{ range $index, $set := .horaire }}
              <button
                class="tab-btn px-4 py-2 rounded-lg border transition-all duration-300 w-full transform hover:scale-105 active:scale-95
                  {{ if eq $index 0 }}
                  bg-primary text-white font-semibold shadow-lg
                {{ else }}
                  bg-white hover:bg-yellow-200 hover:shadow-md
                {{ end }}"
                data-target="horaire-{{ $index }}">
                {{ $set.window }}
              </button>
            {{ end }}
          </div>

          {{ range $index, $set := .horaire }}
            <div
              id="horaire-{{ $index }}"
              class="tab-content transition-all duration-300 {{ if eq $index 0 }}
                block animate-fade-in
              {{ else }}
                hidden
              {{ end }}">
              <div class="overflow-x-auto">
                <table class="w-full table-auto border-collapse">
                  <thead>
                    <tr class="bg-gray-50">
                      <th class="text-left p-3 border-b font-semibold">
                        {{ i18n "activity_single.day_text" }}
                      </th>
                      <th class="text-left p-3 border-b font-semibold">
                        {{ i18n "activity_single.opening_hours_text" }}
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    {{ $today := now | dateFormat "Monday" }}
                    {{ $lang := site.Language.Lang }}
                    {{ $weekdays := slice }}

                    {{ if eq $lang "fr" }}
                      {{ $weekdays = slice "Lundi" "Mardi" "Mercredi" "Jeudi" "Vendredi" "Samedi" "Dimanche" }}
                    {{ else }}
                      {{ $weekdays = slice "Monday" "Tuesday" "Wednesday" "Thursday" "Friday" "Saturday" "Sunday" }}
                    {{ end }}

                    {{ range $i, $day := $weekdays }}
                      {{ $matches := where $set.entries "day" $day }}
                      {{ $entry := cond (gt (len $matches) 0) (index $matches 0) nil }}
                      {{ $isToday := eq $day $today }}
                      <tr class="transition-colors duration-200 hover:bg-gray-50 {{ if $isToday }}font-semibold bg-yellow-50{{ end }}">
                        <td class="p-3 border-b {{ if $isToday }}text-primary{{ end }}">
                          {{ $day }}
                          {{ if $isToday }}<span class="ml-2 text-xs bg-primary text-white px-2 py-1 rounded-full">{{ i18n "today" | default "Today" }}</span>{{ end }}
                        </td>
                        <td class="p-3 border-b">
                          {{ if $entry }}
                            {{ if $entry.hours }}
                              {{ $entry.hours }}
                            {{ else }}
                              <span class="text-gray-500 italic">{{ i18n "activity_single.no_schedule_text" }}</span>
                            {{ end }}
                          {{ else }}
                            <span class="text-gray-500 italic">{{ i18n "activity_single.no_schedule_text" }}</span>
                          {{ end }}
                        </td>
                      </tr>
                    {{ end }}
                  </tbody>
                </table>
              </div>
            </div>
          {{ end }}

          {{ if not .horaire }}
            <p class="text-center text-gray-500 py-8">
              {{ i18n "activity_single.no_schedule_text" }}
            </p>
          {{ end }}
        </div>

        <!-- Pricing -->
        <div class="bg-body p-6 rounded-4xl shadow-4xl basis-[51%] max-w-full card-hover animate-slide-in-right">
          <h2 class="text-xl font-semibold mb-4 text-center">
            {{ i18n "activity_single.pricing_text" }}
          </h2>

          {{ $tickets := where site.RegularPages "Section" "tickets" }}
          {{ $activityName := .name }}
          {{ $filtered := where $tickets "Params.group" $activityName }}

          {{ if gt (len $filtered) 0 }}
            <div class="overflow-x-auto">
              <table class="w-full mb-4 border-collapse table-auto">
                <thead>
                  <tr class="bg-gray-50">
                    <th class="p-3 border-b text-left font-semibold">
                      {{ i18n "activity_single.ticket_text" }}
                    </th>
                    <th class="p-3 border-b text-right min-w-[8rem] font-semibold">
                      {{ i18n "activity_single.price_text" }}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  {{ range $filtered }}
                    <tr class="transition-colors duration-200 hover:bg-gray-50">
                      <td class="prose p-3 border-b">
                        <strong>{{ .Title | markdownify }}</strong><br />
                        <small class="text-gray-600">{{ .Params.info | markdownify }}</small>
                      </td>
                      <td class="p-3 border-b text-right font-semibold text-primary">
                        {{ .Params.price }} â‚¬
                      </td>
                    </tr>
                  {{ end }}
                </tbody>
              </table>
            </div>
          {{ else }}
            <p class="text-center text-gray-500 py-8">
              {{ i18n "activity_single.no_pricing_text" }}
            </p>
          {{ end }}
          <div class="text-center mt-4">
            <a
              href="{{ "practical-information" | relLangURL }}"
              class="inline-block bg-primary text-white px-6 py-3 rounded-lg hover:bg-dark transition-all duration-300 transform hover:scale-105 hover:shadow-lg active:scale-95">
              {{ i18n "activity_single.view_all_prices_text" }}
            </a>
          </div>
        </div>
      </div>

      <!-- Notifications with animations -->
      <div class="animate-fade-in-up-delayed">
        {{ partial "components/notifications.html" .notifications }}
      </div>

      <div class="flex flex-col md:flex-row gap-8 justify-center items-stretch pt-8">
        <div class="bg-body p-6 rounded-4xl shadow-4xl basis-[40%] flex flex-col card-hover animate-slide-in-left">
          <h2 class="text-xl font-semibold mb-4 text-center">
            {{ i18n "activity_single.map_text" }}
          </h2>
          <div class="flex-grow rounded-2xl overflow-hidden">
            {{ partial "components/openstreet_map" . }}
          </div>
        </div>

        <div class="bg-body p-6 rounded-4xl shadow-4xl basis-[60%] flex flex-col card-hover animate-slide-in-right">
          <h2 class="text-xl font-semibold mb-4 text-center">
            {{ i18n "activity_single.contact_text" }}
          </h2>
          <div class="flex-grow">
            {{ partial "components/contact_form" . }}
          </div>
        </div>
      </div>

      <!-- Enhanced Gallery -->
      <div class="animate-fade-in-up-delayed">
        {{ partial "components/gallery" . }}
      </div>
    </div>

    <style>
      /* Animation keyframes */
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes fadeInUp {
        from { 
          opacity: 0; 
          transform: translateY(30px); 
        }
        to { 
          opacity: 1; 
          transform: translateY(0); 
        }
      }

      @keyframes slideUp {
        from { 
          opacity: 0; 
          transform: translateY(50px); 
        }
        to { 
          opacity: 1; 
          transform: translateY(0); 
        }
      }

      @keyframes slideInLeft {
        from { 
          opacity: 0; 
          transform: translateX(-50px); 
        }
        to { 
          opacity: 1; 
          transform: translateX(0); 
        }
      }

      @keyframes slideInRight {
        from { 
          opacity: 0; 
          transform: translateX(50px); 
        }
        to { 
          opacity: 1; 
          transform: translateX(0); 
        }
      }

      /* Animation classes */
      .animate-fade-in {
        animation: fadeIn 1s ease-out;
      }

      .animate-fade-in-up {
        animation: fadeInUp 0.8s ease-out;
      }

      .animate-fade-in-delayed {
        animation: fadeIn 1s ease-out 0.3s both;
      }

      .animate-fade-in-up-delayed {
        animation: fadeInUp 0.8s ease-out 0.5s both;
      }

      .animate-slide-up {
        animation: slideUp 0.8s ease-out;
      }

      .animate-slide-up-delayed {
        animation: slideUp 0.8s ease-out 0.3s both;
      }

      .animate-slide-in-left {
        animation: slideInLeft 0.8s ease-out;
      }

      .animate-slide-in-right {
        animation: slideInRight 0.8s ease-out;
      }

      /* Card hover effects */
      .card-hover {
        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      }

      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
      }

      /* Tab content transitions */
      .tab-content {
        transition: all 0.3s ease-in-out;
      }

      .tab-content.hidden {
        opacity: 0;
        transform: translateY(-10px);
      }

      .tab-content:not(.hidden) {
        opacity: 1;
        transform: translateY(0);
      }

      /* Responsive improvements */
      @media (max-width: 768px) {
        .animate-slide-in-left,
        .animate-slide-in-right {
          animation: fadeInUp 0.8s ease-out;
        }
      }
    </style>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Enhanced tab functionality
        document.querySelectorAll(".tab-btn").forEach((button) => {
          button.addEventListener("click", (e) => {
            e.preventDefault();
            const target = button.getAttribute("data-target");
            
            // Hide all tab contents with fade effect
            document.querySelectorAll(".tab-content").forEach((tab) => {
              tab.style.opacity = '0';
              tab.style.transform = 'translateY(-10px)';
              setTimeout(() => {
                tab.classList.add("hidden");
              }, 150);
            });
            
            // Show target tab with fade effect
            setTimeout(() => {
              const targetTab = document.getElementById(target);
              targetTab.classList.remove("hidden");
              setTimeout(() => {
                targetTab.style.opacity = '1';
                targetTab.style.transform = 'translateY(0)';
              }, 50);
            }, 150);
            
            // Update button states
            document.querySelectorAll(".tab-btn").forEach((btn) => {
              btn.classList.remove("bg-primary", "font-semibold", "text-white", "shadow-lg");
              btn.classList.add("bg-white", "hover:bg-yellow-200");
            });
            button.classList.remove("bg-white", "hover:bg-yellow-200");
            button.classList.add("bg-primary", "font-semibold", "text-white", "shadow-lg");
          });
        });

        // Intersection Observer for scroll animations
        const observerOptions = {
          threshold: 0.1,
          rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.style.animationPlayState = 'running';
            }
          });
        }, observerOptions);

        // Observe animated elements
        document.querySelectorAll('[class*="animate-"]').forEach(el => {
          el.style.animationPlayState = 'paused';
          observer.observe(el);
        });

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
              target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          });
        });
      });
    </script>
  {{ end }}
{{ end }}